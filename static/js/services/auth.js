import{storage}from'../utils/storage.js';import{config}from'../config/config.js';export class AuthService{static async login(username,password){const res=await fetch(`${config.apiUrl}/auth/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(!res.ok)throw new Error('Login failed');const data=await res.json();storage.set(config.tokenKey,data.access_token);storage.set(config.userKey,{id:data.user_id,username:data.username});return data}static async register(username,password){const res=await fetch(`${config.apiUrl}/auth/register`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(!res.ok)throw new Error('Register failed');const data=await res.json();storage.set(config.tokenKey,data.access_token);storage.set(config.userKey,{id:data.user_id,username:data.username});return data}static async guest(name){const res=await fetch(`${config.apiUrl}/auth/guest`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name})});const data=await res.json();storage.set(config.tokenKey,data.access_token);storage.set(config.userKey,{id:data.user_id,username:data.username,is_guest:true});return data}static logout(){storage.remove(config.tokenKey);storage.remove(config.userKey);window.location.href='/'}static getUser(){return storage.get(config.userKey)}static getToken(){return storage.get(config.tokenKey)}static isAuthenticated(){return!!this.getToken()}}
