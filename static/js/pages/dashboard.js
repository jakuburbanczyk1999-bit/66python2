import{$,$$,hide,show}from'../utils/dom.js';import{AuthService}from'../services/auth.js';import{API}from'../services/api.js';import{LobbyCard}from'../components/LobbyCard.js';if(!AuthService.isAuthenticated()){window.location.href='/';throw new Error('Not authenticated')}const user=AuthService.getUser();$$('.user-name').forEach(el=>el.textContent=user.username);$('#welcome-user-name').textContent=user.username;$('#logout-btn')?.addEventListener('click',()=>AuthService.logout());$$('.tab-btn').forEach(btn=>{btn.addEventListener('click',()=>{$$('.tab-btn').forEach(b=>b.classList.remove('active'));$$('.tab-content').forEach(c=>c.classList.remove('active'));btn.classList.add('active');const tab=btn.dataset.tab;$(`#tab-${tab}`)?.classList.add('active')})});$('#create-lobby-form')?.addEventListener('submit',async(e)=>{e.preventDefault();const data={lobby_type:$('#lobby-type').value,game_mode:$('#game-mode').value,ranked:$('#ranked-checkbox').checked,password:$('#lobby-password').value||null};try{const lobby=await API.createLobby(data);window.location.href=`/game.html?id=${lobby.id_gry}`}catch(err){alert('Błąd tworzenia lobby')}});async function loadLobbies(){const grid=$('#lobbies-grid');try{const lobbies=await API.getLobbies();if(lobbies.length===0){show($('#lobbies-empty'))}else{grid.innerHTML=lobbies.map(l=>LobbyCard.create(l)).join('')}}catch(err){grid.innerHTML='<p>Błąd ładowania lobby</p>'}}$('#refresh-lobbies-btn')?.addEventListener('click',loadLobbies);window.joinLobby=async(id)=>{try{await API.joinLobby(id);window.location.href=`/game.html?id=${id}`}catch{alert('Błąd dołączania')}};setTimeout(loadLobbies,500);
